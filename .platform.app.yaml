name: app
type: php:7.2
build:
  flavor: composer

web:
  locations:
    "/":
      root: "public"
      passthru: "/index.php"
      index:
        - index.php
      allow: true
      headers:
        x-testing: "hello"

    # "/info":
    #   root: "public"
    #   passthru: "/info.php"

    # "/submodule":
    #   root: "test-submodule/public"
    #   passthru: "/index.php"
    #   index:
    #     - index.php
    #   allow: true

relationships:
  database: "mysqldb:mysql"
  solr: "solrsearch:solr"

#
mounts:
  "test-mount": "shared:files/test-mount"
disk: 2048
#
cron:
  job1:
    spec: "* * * * *"
    cmd: "echo $PATH"

dependencies:
  nodejs:
    gulp-cli: "*"
hooks:
  build: |
    echo $PATH
    if [ ! -d /mnt/cache/ruby-2.5 ]; then
      echo "compiling Ruby"
      wget https://cache.ruby-lang.org/pub/ruby/2.5/ruby-2.5.1.tar.gz
      tar xzvf ruby-2.5.1.tar.gz && cd ruby-2.5.1
      ./configure --prefix=/mnt/cache/ruby-2.5
      make && make install
    fi
    cp -r /mnt/cache/ruby-2.5/bin/* /app/.global/bin/
    which ruby
    gem install sassc
    npm install
    gulp
    ls -l /mnt/cache
  deploy: |
    echo "This is the deploy hook firing!"
    if 
  post_deploy:
    echo "Post deploy"
